#!/bin/bash

# Script para corregir permisos especÃ­ficos de los directorios de upload
# Ejecuta comandos directos en el servidor

echo "ğŸ”§ Comandos para corregir permisos de directorios de upload"
echo ""
echo "Ejecuta estos comandos EN EL SERVIDOR (como root):"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "cd /home/api.heroedelwhisky.com.ar/public_html/apps/backend"
echo ""
echo "# Verificar usuario de PHP-FPM workers"
echo "ps aux | grep 'php-fpm: pool' | grep -v grep | head -1"
echo ""
echo "# Verificar permisos actuales"
echo "ls -ld storage/app/public/system/logos"
echo "ls -ld storage/app/public/system/favicons"
echo ""
echo "# Configurar permisos con setgid para que los nuevos archivos hereden el grupo"
echo "chmod 2775 storage/app/public/system"
echo "chmod 2775 storage/app/public/system/logos"
echo "chmod 2775 storage/app/public/system/favicons"
echo ""
echo "# Configurar ownership (ajusta USER segÃºn el resultado del primer comando)"
echo "chown -R www-data:www-data storage/app/public/system"
echo ""
echo "# O si el usuario PHP-FPM es diferente (por ejemplo nginx):"
echo "# chown -R nginx:nginx storage/app/public/system"
echo ""
echo "# Verificar permisos finales"
echo "ls -ld storage/app/public/system"
echo "ls -ld storage/app/public/system/logos"
echo "ls -ld storage/app/public/system/favicons"
echo ""
echo "# Probar escritura como el usuario PHP-FPM"
echo "# Si PHP-FPM es www-data:"
echo "sudo -u www-data touch storage/app/public/system/logos/test.txt && sudo -u www-data rm storage/app/public/system/logos/test.txt && echo 'âœ… Escritura OK' || echo 'âŒ Error de escritura'"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ğŸ’¡ SOLUCIÃ“N RÃPIDA (copia y pega todo en el servidor):"
echo ""
echo "cd /home/api.heroedelwhisky.com.ar/public_html/apps/backend && chmod -R 2775 storage/app/public/system && chown -R www-data:www-data storage/app/public/system && sudo -u www-data touch storage/app/public/system/logos/test.txt && sudo -u www-data rm storage/app/public/system/logos/test.txt && echo 'âœ… Permisos correctos' || echo 'âŒ Revisa el usuario PHP-FPM'"
echo ""

